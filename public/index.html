<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <!-- Viewport meta tag so the layout adapts to mobile screens instead of being rendered as a zoomed-out desktop page.
       MDN (meta name="viewport"): https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/meta/name/viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Emoji favicon rendered via an inline SVG data URL. This avoids maintaining a separate favicon file.
       MDN (link element & icons): https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/link
       MDN (Favicon glossary): https://developer.mozilla.org/en-US/docs/Glossary/Favicon -->
  <link rel="icon" href="data:image/svg+xml,
    <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
      <text y='0.9em' font-size='90'>⌛️</text>
    </svg>" />

  <title>Time Shop · 时间商店</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <!-- Top-level page wrapper, primarily used for background and page-level layout. -->
  <div class="page">
    <div class="app">
      <!-- Global header: brand identity on the left and time counters on the right. -->
      <header class="app-header">
        <div class="header-left">
          <div class="brand-row">
            <div class="brand">⌛️ Time Shop · 时间商店</div>

            <!-- Button that opens the rules/tutorial overlay. -->
            <button id="openGuideBtn" class="btn btn-ghost" type="button">
              View rules / 查看规则
            </button>
          </div>

          <!-- Short descriptive tagline for the project. -->
          <div class="brand-subline">
            Idle time-based card game · 一个用「时间」换取卡牌的小实验
          </div>

          <!-- Clarifies that “time” only advances while this tab is active. -->
          <div class="subtitle">
            Time only accumulates while your account stays in this window.<br />
            只有停留在当前窗口内时，你的账号时间才会继续累积。
          </div>
        </div>

        <!-- Right-hand timer panel: global total time and per-session time for the current account. -->
        <div class="timer-panel">
          <!-- Aggregated play time across all accounts. -->
          <div class="timer-row">
            <div class="timer-item">
              <div class="timer-label">Total Time (all users) / 所有用户总时长</div>
              <div class="timer-value" id="timerDisplay">00:00:00</div>
            </div>
          </div>

          <!-- Time spent by this logged-in account on the current page. -->
          <div class="timer-row">
            <div class="timer-item">
              <div class="timer-label">You on this page / 你在此页面的时间</div>
              <div class="timer-value" id="sessionTimer">00:00:00</div>
            </div>
          </div>
        </div>
      </header>

      <!-- Main interactive surface: arranged in a top row and a bottom row. -->
      <main>
        <!-- Top row: left column (Player + Online User), right column (Lottery). -->
        <div class="row row-top">
          <div class="col-left">
            <!-- Player card: per-account status and the “Collect +1” button. -->
            <section class="card card-player">
              <h2>Player / 玩家</h2>

              <div class="player-stats">
                <!-- Display current username for this session. -->
                <div class="stat-pill">
                  <span class="stat-label">User / 用户</span>
                  <span class="stat-value" id="usernameLabel-side">—</span>
                </div>

                <!-- Display current coin balance (updated by JS when coins are earned or spent). -->
                <div class="stat-pill stat-pill-coins">
                  <span class="stat-label">Coins / 硬币</span>
                  <span class="stat-value" id="coinLabel">0</span>
                </div>

                <!-- Time-gated reward button:
                     Appears every 20 seconds and remains clickable for 3 seconds, controlled by JavaScript. -->
                <button id="coinSpawnBtn" class="btn coin-claim-btn" type="button" style="display: none;">
                  Collect +1 / 领取 +1
                </button>
              </div>

              <!-- Textual explanation of the 20s / 3s reward mechanic. Styled in a warning color. -->
              <p class="fine fine-warning">
                Every <strong>20 seconds</strong>, a “Collect +1” button appears for <strong>3 seconds</strong> only.<br />
                每累计 <strong>20 秒</strong> 会短暂出现 3 秒的奖励按钮，点中获得 1 枚硬币，错过就没有奖励。
              </p>
            </section>

            <!-- Online User card: presence list synchronized via Socket.IO. -->
            <section class="card card-social">
              <div class="section-header">
                <h2>Online User / 在线用户</h2>
                <!-- Small inline toggle. JS reads this checkbox to decide whether to broadcast coin data. -->
                <label class="toggle-inline">
                  <input type="checkbox" id="toggleHideCoins" />
                  <span>Hide my coins / 隐藏我的硬币</span>
                </label>
              </div>

              <!-- Copy explaining how the list is scoped to online visitors only. -->
              <p class="section-desc">
                Live view of accounts currently on this page. Offline accounts will not be shown.<br />
                此处只展示正在浏览该页面的账号，离线账号不会出现。
              </p>

              <!-- Dynamic container: JS inserts one child block per online user. -->
              <div id="onlineUsersList" class="online-users-list"></div>
            </section>
          </div>

          <!-- Lottery column: handles the gacha interaction and probability labels. -->
          <div class="col-right">
            <section class="card card-lottery">
              <div class="section-header">
                <h2>Lottery / 抽卡区</h2>
                <span class="section-tag">Spend 3 coins / 消耗 3 枚硬币</span>
              </div>

              <!-- Basic description of the gacha rules and rarity scale. -->
              <p class="section-desc">
                Every 3 coins let you draw one card. Rarity ranges from S (super rare) to F, plus “No prize”.<br />
                每 3 枚硬币可抽取 1 张卡牌，稀有度从 S 到 F，以及「未中奖」。
              </p>

              <div class="lottery-actions">
                <!-- Main call-to-action for drawing a card.
                     Starts disabled and is enabled by JS once the user has ≥ 3 coins. -->
                <button id="drawBtn" class="btn primary draw-btn" type="button" disabled>
                  Enter Lottery / 参与抽卡
                  <span class="btn-sub">Spend 3 coins / 消耗 3 枚硬币</span>
                </button>
              </div>

              <!-- Flip-card container: front/back faces used by the JS-driven flip animation.
                   The inner wrapper (.flip-card-inner) is typically the element that gets the rotation transform. -->
              <div class="flip-card" id="flipCard">
                <div class="flip-card-inner">
                  <!-- Front side: card back shown before and after each draw. -->
                  <div class="flip-card-front">
                    <img id="cardFront" src="./assets/cards/back.jpg" alt="Card back" />
                  </div>
                  <!-- Back side: updated to the actual result image when a draw completes. -->
                  <div class="flip-card-back">
                    <img id="cardBack" src="./assets/cards/back.jpg" alt="Card front" />
                  </div>
                </div>
              </div>

              <!-- Short explanation of the flip sequence: back → result → back. -->
              <p class="fine">
                After each draw, the card flips to show the result, holds for a few seconds, then flips back.<br />
                每次抽卡会先显示卡背，再翻转展示结果，停留数秒后翻回卡背。
              </p>

              <!-- Rarity buttons: each button is tagged with data-level so JS can query reviews for that rarity. -->
              <div class="rarity-row">
                <button class="rarity-item" type="button" data-level="S">
                  <span class="badge badge-S">S</span><span>0.5%</span>
                </button>
                <button class="rarity-item" type="button" data-level="A">
                  <span class="badge badge-A">A</span><span>2%</span>
                </button>
                <button class="rarity-item" type="button" data-level="B">
                  <span class="badge badge-B">B</span><span>5%</span>
                </button>
                <button class="rarity-item" type="button" data-level="C">
                  <span class="badge badge-C">C</span><span>10%</span>
                </button>
                <button class="rarity-item" type="button" data-level="D">
                  <span class="badge badge-D">D</span><span>12.5%</span>
                </button>
                <button class="rarity-item" type="button" data-level="E">
                  <span class="badge badge-E">E</span><span>25%</span>
                </button>
                <button class="rarity-item" type="button" data-level="F">
                  <span class="badge badge-F">F</span><span>25%</span>
                </button>
                <button class="rarity-item" type="button" data-level="NONE">
                  <span class="badge badge-none">No</span><span>20%</span>
                </button>
              </div>

              <!-- Guidance for using the rarity buttons as an entry point into the review system. -->
              <p class="fine">
                Click a rarity above to read reviews from players who own that level of card.<br />
                点击上方任意稀有度按钮，可以查看拥有该等级卡牌玩家的评价。
              </p>
            </section>
          </div>
        </div>

        <!-- Bottom row: Inventory (card collection) and Activity (simple log). -->
        <div class="row row-bottom">
          <!-- Inventory shows all cards bound to the current logged-in account. -->
          <section class="card card-inventory">
            <div class="section-header">
              <h2>Inventory / 卡牌背包</h2>
            </div>
            <p class="section-desc">
              All cards you’ve drawn under this account will appear here. Click any card to view it larger,
              write a review, or save the image.<br />
              使用当前账号抽到的所有卡牌都会出现在这里。点击任意卡牌可以查看大图、撰写评价或保存图片。
            </p>

            <!-- Grid container; JS injects card thumbnails here. -->
            <div id="inventory" class="inventory-grid"></div>
          </section>

          <!-- Activity log: textual feedback about events (login, draws, coin gains, etc.). -->
          <section class="card card-activity">
            <div class="section-header">
              <h2>Activity / 活动记录</h2>
            </div>
            <p class="section-desc">
              A small log of what happens on this account while you stay on the page.<br />
              记录你在本页面停留期间发生的一些关键事件。
            </p>

            <!-- Scrollable container; JS appends log lines here. -->
            <div id="log" class="log-box"></div>
          </section>
        </div>
      </main>

      <!-- Footer summarizing the conceptual framing of the project. -->
      <footer class="app-footer">
        <span>Time Shop is a tiny experiment about trading idle time for virtual cards.</span>
        <span>Time Shop 是一个用碎片时间换取虚拟卡牌的小实验。</span>
      </footer>
    </div>
  </div>

  <!-- ========= Auth overlay: signup / login flow in a light theme ========= -->
  <!-- Full-screen overlay that blocks interaction with the app until the user signs up or logs in. -->
  <div id="authOverlay" class="auth-overlay">
    <div class="auth-card">
      <h1>Time Shop · 时间商店</h1>
      <p class="auth-subtitle">
        The resources will be linked to this account.<br />
        时间、硬币和卡牌会绑定在此账号上。
      </p>

      <!-- Username input; JS reads this value when handling signup/login events.
           The autocomplete attribute lets the browser suggest stored usernames.
           Autocomplete attribute: https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Attributes/autocomplete -->
      <div class="auth-input-row">
        <label for="authUsername">Username 用户名</label>
        <input id="authUsername" type="text" autocomplete="username" />
      </div>

      <!-- Password input; type="password" masks characters. autocomplete hints stored passwords. -->
      <div class="auth-input-row">
        <label for="authPassword">Password 密码</label>
        <input id="authPassword" type="password" autocomplete="current-password" />
      </div>

      <!-- Two separate buttons so JS can call different API endpoints for signup vs login. -->
      <div class="auth-actions">
        <button id="signupBtn" class="btn primary" type="button">Sign up 注册</button>
        <button id="loginBtn" class="btn" type="button">Log in 登录</button>
      </div>

      <!-- Area for inline auth feedback (e.g., success, error messages). -->
      <div id="authMessage" class="auth-message"></div>
    </div>
  </div>
  <!-- End of auth overlay -->

  <!-- Signup success + rules overlay (single, reusable guide dialog) -->
  <!-- This overlay serves both as a “welcome” screen and a rules explanation, and can be reopened via the header button. -->
  <div id="signupGuideOverlay" class="signup-guide-overlay">
    <div class="signup-guide-backdrop"></div>
    <div class="signup-guide-card">
      <!-- Close button in the top-right corner, using × as a simple icon. -->
      <button id="signupGuideClose" class="signup-guide-close" type="button" aria-label="Close guide">
        ×
      </button>

      <h2 class="signup-guide-title">Welcome to Time Shop / 欢迎来到时间商店</h2>
      <p class="signup-guide-intro">
        A short guide about how time and coins work on this site.<br />
        下方是关于本网站「时间与硬币」规则的简要说明。
      </p>

      <!-- Two-column layout: English on the left, Chinese on the right. -->
      <div class="signup-guide-columns">
        <div class="signup-guide-block">
          <h3>English</h3>
          <ol>
            <li>Time will only accumulate while you remain on this page. Time is your money.</li>
            <li>Every <strong>20 seconds</strong>, “Collect +1” button may appear, tap it to gain 1 coin.</li>
            <li>The “Collect +1” button only lasts for 3 seconds. Don’t miss it.</li>
            <li>Each lottery costs 3 coins. You may draw a card of different rarity.</li>
            <li>Welcome! Here are two coins as a gift for you. Good luck!</li>
          </ol>
        </div>

        <div class="signup-guide-block">
          <h3>中文</h3>
          <ol>
            <li>只有停留在当此页面时，时间才会持续累积。时间就是你的金钱。</li>
            <li>每累计 <strong>20 秒</strong>，有机会出现一次 “Collect +1” 按钮，点击可获得 1 枚硬币。</li>
            <li>该按钮只存在 3 秒钟，错过就没有奖励。</li>
            <li>每次抽卡需要消耗 3 枚硬币，有机会获得不同稀有度的卡牌，也可能未中奖。</li>
            <li>欢迎你的加入，系统会赠送你 2 枚硬币作为礼物。祝你好运！</li>
          </ol>
        </div>
      </div>

      <!-- Primary action for closing the guide; JS hides the overlay and resumes the main app. -->
      <div class="signup-guide-actions">
        <button id="signupGuideGotIt" class="btn primary" type="button">
          Got it / 我知道了
        </button>
      </div>
    </div>
  </div>
  <!-- ========= End of rules overlay ========= -->

  <!-- Inventory fullscreen viewer: image + label + review input + local save button. -->
  <div id="imageViewer" class="image-viewer">
    <div class="image-viewer-backdrop"></div>
    <div class="image-viewer-content">
      <!-- Close icon for the fullscreen viewer. -->
      <button id="imageViewerClose" class="image-viewer-close" type="button" aria-label="Close full image">
        ×
      </button>

      <!-- Save button pinned to the top-left corner of the viewer.
           JS wires this up to trigger a client-side download of the current card image. -->
      <button id="imageViewerSaveBtn" type="button" class="btn image-viewer-save">
        Save card / 保存卡牌
      </button>

      <!-- The large card image (src is set by JS when a thumbnail is clicked). -->
      <img id="imageViewerImg" alt="Card preview" />
      <!-- Text label for the card, e.g., rarity and name. -->
      <div id="imageViewerLabel" class="image-viewer-label"></div>

      <!-- Inline review composer: one-line input + send button. -->
      <div class="image-viewer-review">
        <input id="imageViewerReviewInput" type="text"
          placeholder="Write a review about this card / 针对这张卡写下你的评价" />
        <button id="imageViewerReviewSend" type="button" class="btn primary image-viewer-review-send">
          Send / 发送
        </button>
      </div>
    </div>
  </div>

  <!-- Lottery rarity review modal:
       Opened when a rarity button is clicked; shows reviews from other players for that rarity. -->
  <div id="reviewModal" class="review-modal">
    <div class="review-modal-backdrop"></div>
    <div class="review-modal-content">
      <button id="reviewModalClose" class="review-modal-close" type="button" aria-label="Close reviews">
        ×
      </button>
      <h3 id="reviewModalTitle" class="review-modal-title">Reviews</h3>
      <!-- JS populates this container with review items returned from the server. -->
      <div id="reviewModalBody" class="review-modal-body"></div>
    </div>
  </div>

  <!-- Socket.IO client library (served by the Node.js backend) plus the main application script. -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="./app.js"></script>
</body>

</html>
