<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- 浏览器 tab 上的 emoji favicon：⌛️ -->
  <link rel="icon" href="data:image/svg+xml,
    <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
      <text y='0.9em' font-size='90'>⌛️</text>
    </svg>" />

  <title>Time Shop · 时间商店</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <div class="page">
    <div class="app">
      <!-- ========= 登录 / 注册遮罩 ========= -->
      <div id="authOverlay" class="auth-overlay">
        <div class="auth-card">
          <h1>Time Shop · 时间商店</h1>
          <p class="auth-subtitle">
            The resources will be linked to this account.<br />
            时间、硬币和卡牌会绑定在此账号上。
          </p>

          <div class="auth-input-row">
            <label for="authUsername">Username 用户名</label>
            <input id="authUsername" type="text" autocomplete="username" />
          </div>

          <div class="auth-input-row">
            <label for="authPassword">Password 密码</label>
            <input id="authPassword" type="password" autocomplete="current-password" />
          </div>

          <div class="auth-actions">
            <button id="signupBtn" class="btn primary">Sign up 注册</button>
            <button id="loginBtn" class="btn">Log in 登录</button>
          </div>

          <div id="authMessage" class="auth-message"></div>
        </div>
      </div>
      <!-- ========= 登录遮罩结束 ========= -->

      <!-- ========= 注册成功后规则弹窗（美观版） ========= -->
      <div id="signupGuideOverlay" class="signup-guide-overlay">
        <div class="signup-guide-backdrop"></div>
        <div class="signup-guide-card">
          <button id="signupGuideClose" class="signup-guide-close" type="button" aria-label="Close guide">
            ×
          </button>
          <h2 class="signup-guide-title">Welcome to Time Shop / 欢迎来到时间商店</h2>
          <p class="signup-guide-intro">
            A short guide about how time and coins work in this site.<br />
            下方是关于本网站「时间与硬币」规则的简要说明。
          </p>

          <div class="signup-guide-columns">
            <div class="signup-guide-block">
              <h3>English</h3>
              <ol>
                <li>Time will only accumulate while you remain on this page. Time is your money.</li>
                <li>Every 2 mins, a "Collect +1" button will appear. Clicking it will grant you
                  1 coin.</li>
                <li>The "Collect +1" button only lasts for 3 seconds. Don't miss it.</li>
                <li>Each lottery costs 3 coins. You may draw a card of different rarity, or get no prize.</li>
                <li>Welcome! Here are two coins as a gift for you. Good luck!</li>
              </ol>
            </div>

            <div class="signup-guide-block">
              <h3>中文</h3>
              <ol>
                <li>只有停留在当此页面时，时间才会持续累积。时间是你的金钱。</li>
                <li>每累计 120 秒，会短暂出现“领取 +1 / Collect +1”按钮，点到就可以多获得 1 枚硬币。</li>
                <li>“领取 +1 / Collect +1”按钮只有 3 秒，没点到就不会获得硬币。</li>
                <li>每次抽卡消耗 3 枚硬币，可能抽到不同稀有度的卡牌，也有可能未中奖。</li>
                <li>欢迎你的加入，送给你2枚硬币作为礼物。祝你好运！</li>
              </ol>
            </div>
          </div>

          <div class="signup-guide-actions">
            <button id="signupGuideGotIt" class="btn primary">
              Got it / 我知道了
            </button>
          </div>
        </div>
      </div>
      <!-- ========= 注册成功后规则弹窗结束 ========= -->

      <!-- 顶部标题 + 计时信息 -->
      <header class="app-header">
        <div class="header-left">
          <div class="brand">⌛️ Time Shop · 时间商店</div>
          <div class="brand-subline">
            Idle time-based card game · 一个用「时间」换取卡牌的小实验
          </div>
          <div class="subtitle">
            Time will only continue to accumulate while the account remains in the current window.<br />
            只有停留在本窗口内时，时间才会继续累积。
          </div>
        </div>

        <div class="timer-panel">
          <!-- 全站总时长 -->
          <div class="timer-row">
            <div class="timer-item">
              <div class="timer-label">Total Time (all users) / 所有用户总时长</div>
              <div class="timer-value" id="timerDisplay">00:00:00</div>
            </div>
          </div>
          <!-- 当前账号在本页面的时长 + 账号名 -->
          <div class="timer-row">
            <div class="timer-item">
              <div class="timer-label">You on this page / 你在此页面的时间</div>
              <div class="timer-value" id="sessionTimer">00:00:00</div>
            </div>
            <div class="timer-item">
              <div class="timer-label">User (account) / 当前账号</div>
              <div class="timer-value" id="usernameLabel">—</div>
            </div>
          </div>
        </div>
      </header>

      <main>
        <!-- 上排：左列 = Player + Online User；右列 = Lottery -->
        <div class="row row-top">
          <div class="col-left">
            <!-- Player：个人信息 -->
            <section class="card card-player">
              <h2>Player / 玩家</h2>

              <div class="player-stats">
                <div class="stat-pill">
                  <span class="stat-label">User / 用户</span>
                  <span class="stat-value" id="usernameLabel-side">—</span>
                </div>

                <div class="stat-pill stat-pill-coins">
                  <span class="stat-label">Coins / 硬币</span>
                  <span class="stat-value" id="coinLabel">0</span>
                </div>

                <!-- 每 120 秒出现一次，3 秒内可点击领取 +1 coin 的按钮 -->
                <button id="coinSpawnBtn" class="btn coin-claim-btn" style="display: none;">
                  Collect +1 / 领取 +1
                </button>
              </div>

              <!-- 规则说明：120 秒一次，3 秒内点击才记入硬币 -->
              <p class="fine">
                Every 120s, the "Collect +1" button only lasts for 3 seconds. Don't miss it.<br />
                每累计 120 秒，会出现 3 秒的奖励按钮。点中 +1 硬币，错过则没有奖励。
              </p>
            </section>

            <!-- Online User：只展示在线账号的用户名、coins（可隐藏）、最近卡片等级 -->
            <section class="card card-social">
              <div class="section-header">
                <h2>Online User / 在线用户</h2>
                <label class="toggle-inline">
                  <input type="checkbox" id="toggleHideCoins" />
                  <span>Hide my coins / 隐藏我的硬币</span>
                </label>
              </div>
              <p class="section-desc">
                Live view of accounts currently on this page. Offline accounts are not shown.<br />
                此处只展示正在浏览该页面的账号，离线账号不会出现。
              </p>
              <div id="onlineUsersList" class="online-users-list"></div>
            </section>
          </div>

          <!-- Lottery：抽卡区 -->
          <section class="card card-lottery">
            <div class="section-header">
              <h2>Lottery / 抽卡区</h2>
              <span class="section-tag">3 coins per draw / 每次消耗 3 枚硬币</span>
            </div>
            <p class="section-desc">
              Spend 3 coins to draw one card with different rarity levels.<br />
              每次消耗 3 枚硬币，可以抽取一张不同稀有度的卡牌。
            </p>
            <p class="section-desc">
              Each button shows its drop rate and, when clicked, reviews from players who own that card.<br />
              每个等级按钮会显示掉落率，点击可查看拥有者的评价。
            </p>

            <!-- 稀有度 + 概率：这里的按钮可以点击查看该等级评论 -->
            <div class="rarity-row">
              <button class="rarity-item" type="button" data-level="S">
                <span class="badge badge-S">S</span><span>0.5%</span>
              </button>
              <button class="rarity-item" type="button" data-level="A">
                <span class="badge badge-A">A</span><span>2%</span>
              </button>
              <button class="rarity-item" type="button" data-level="B">
                <span class="badge badge-B">B</span><span>5%</span>
              </button>
              <button class="rarity-item" type="button" data-level="C">
                <span class="badge badge-C">C</span><span>10%</span>
              </button>
              <button class="rarity-item" type="button" data-level="D">
                <span class="badge badge-D">D</span><span>12.5%</span>
              </button>
              <button class="rarity-item" type="button" data-level="E">
                <span class="badge badge-E">E</span><span>25%</span>
              </button>
              <button class="rarity-item" type="button" data-level="F">
                <span class="badge badge-F">F</span><span>25%</span>
              </button>
              <button class="rarity-item" type="button" data-level="NONE">
                <span class="badge badge-none">No</span><span>20%</span>
              </button>
            </div>

            <!-- 翻牌动画 -->
            <div class="flip-zone">
              <div class="flip" id="flipCard">
                <div class="flip-inner">
                  <div class="flip-face flip-front">
                    <img id="cardFront" src="./assets/cards/back.jpg" alt="Card back" />
                  </div>
                  <div class="flip-face flip-back">
                    <img id="cardBack" src="./assets/cards/back.jpg" alt="Result card" />
                  </div>
                </div>
              </div>
            </div>

            <div class="actions actions-lower">
              <button id="drawBtn" class="btn primary" disabled>
                Enter Lottery / 参与抽卡
                <span class="btn-sub">Spend 3 coins / 消耗 3 枚硬币</span>
              </button>
              <button id="resetBtn" class="btn danger">
                Reset Account Data / 重置账号数据
              </button>
            </div>
          </section>
        </div>

        <!-- 下排：Inventory + Activity -->
        <div class="row row-bottom">
          <section class="card card-inventory">
            <div class="section-header">
              <h2>Inventory / 卡牌背包</h2>
              <span class="section-tag soft">
                Collected cards / 已抽到的卡牌
              </span>
            </div>
            <p class="section-desc">
              All cards drawn by this account.<br />
              当前账号已经抽到的所有卡牌。
            </p>
            <div id="inventory" class="grid inventory"></div>
          </section>

          <section class="card card-log">
            <div class="section-header">
              <h2>Activity / 活动记录</h2>
              <span class="section-tag soft">
                Local log / 本地日志
              </span>
            </div>
            <p class="section-desc">
              A short trace of what happened on this account.<br />
              记录本账号在本页面发生过的小事件。
            </p>
            <div id="log" class="log"></div>
          </section>
        </div>
      </main>

      <footer class="app-footer">
        <div>@Jaylin Xu</div>
        <div>2025</div>
      </footer>
    </div>
  </div>

  <!-- Inventory 大图 + 评论模态层 -->
  <div id="imageViewer" class="image-viewer">
    <div class="image-viewer-backdrop"></div>
    <div class="image-viewer-content">
      <button id="imageViewerClose" class="image-viewer-close" type="button" aria-label="Close full image">
        ×
      </button>
      <img id="imageViewerImg" alt="Card preview" />
      <div id="imageViewerLabel" class="image-viewer-label"></div>

      <div class="image-viewer-review">
        <input id="imageViewerReviewInput" type="text" placeholder="Write a review about this card / 针对这张卡写下你的评价" />
        <button id="imageViewerReviewSend" type="button" class="btn primary image-viewer-review-send">
          Send / 发送
        </button>
      </div>
    </div>
  </div>

  <!-- Lottery / 评论查看模态层 -->
  <div id="reviewModal" class="review-modal">
    <div class="review-modal-backdrop"></div>
    <div class="review-modal-content">
      <button id="reviewModalClose" class="review-modal-close" type="button" aria-label="Close reviews">
        ×
      </button>
      <h3 id="reviewModalTitle" class="review-modal-title">Reviews</h3>
      <div id="reviewModalBody" class="review-modal-body"></div>
    </div>
  </div>

  <!-- socket.io 客户端脚本 -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="./app.js"></script>
</body>

</html>
